<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>{{ page.title }} | Formid'Alpes</title>
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="icon" type="image/png" href="/favicon.png">
    
    <link rel="stylesheet" href="/style.css"> 
    
    </head>
<body>
    <header>
        {% include header.html %}
    </header>

    <main>
        {{ content }}
    </main>

    <footer>
        {% include footer.html %}
    </footer>
    
	<script>

// La fonction chargerTemoignages est maintenant la première dans le bloc <script>

        const CSV_FEED_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSH664zy7-EuWIs3doKS8tsZhstJh0rWrYWBKWKpugsIEpabix6ZWmTKhCK-O_Md9czA2RmVncwgo5O/pub?gid=1525314360&single=true&output=csv'; 
        
        // ATTENTION : La variable MAX_TEMOIGNAGES n'est plus nécessaire car on utilise maxAvis
        
        const COL_INDICES = {
            TIMESTAMP: 0,
            NOTE_GLOBALE: 14,
            APPRECIATION_PUBLIQUE: 17,
            PRENOM_STAGIAIRE: 2,
            FORMATION_SUIVIE: 4 
        };

        function chargerTemoignages() {
            // 1. Détermine quel conteneur utiliser
            const isHomePage = document.getElementById('temoignages-recent');
            const isArchivesPage = document.getElementById('temoignages-complet');
            
            let container;
            let maxAvis;

            if (isHomePage) {
                container = isHomePage;
                maxAvis = 3; // N'affiche que les 3 derniers sur l'accueil
            } else if (isArchivesPage) {
                container = isArchivesPage;
                maxAvis = Infinity; // Affiche TOUS les avis sur la page dédiée
            } else {
                return; // Quitte si aucun conteneur n'est trouvé
            }

            container.innerHTML = `<p style="text-align: center;">Chargement des avis en cours...</p>`;

            fetch(CSV_FEED_URL)
                .then(response => response.text())
                .then(csvText => {
                    const rows = csvText.trim().split('\n');
                    rows.shift(); // Retirer l'en-tête
                    
                    const temoignages = rows.reverse().map(row => {
                        // Utilisation de split(',') est correcte si la virgule est le séparateur et pas de virgule dans le texte
                        const cols = row.split(',').map(col => col.trim().replace(/^"|"$/g, ''));
                        
                        return {
                            rating: cols[COL_INDICES.NOTE_GLOBALE], 
                            text: cols[COL_INDICES.APPRECIATION_PUBLIQUE],
                            name: cols[COL_INDICES.PRENOM_STAGIAIRE],
                            subtitle: cols[COL_INDICES.FORMATION_SUIVIE]
                        };
                    }).filter(t => t.text && t.text.length > 5);

                    container.innerHTML = '';
                    
                    // --- CORRECTION CLÉ ICI : Utiliser le maxAvis dynamique ---
                    const temoignagesAAfficher = temoignages.slice(0, maxAvis); 
                    
                    if (temoignagesAAfficher.length === 0) {
                        container.innerHTML = `<p style="text-align: center;">Aucun avis n'a encore été publié.</p>`;
                        return;
                    }
                    // --- FIN DE CORRECTION CLÉ ---

                    temoignagesAAfficher.forEach(t => {
                        const note = parseFloat(t.rating) || 0;
                        const stars = '⭐'.repeat(Math.round(note)); 

                        const html = `
                            <div class="testimonial-item fade-in visible">
                                <div class="testimonial-content">
                                    <p><strong>${stars} (${note}/5)</strong></p>
                                    <p>"${t.text}"</p>
                                    <div class="testimonial-author">
                                        <strong>${t.name}</strong>
                                        <span>${t.subtitle}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        container.innerHTML += html;
                    });
                })
                .catch(error => {
                    console.error("Erreur lors du chargement des témoignages:", error);
                    container.innerHTML = `<p style="text-align: center; color: red;">Désolé, impossible de charger les avis pour le moment. Erreur CSV.</p>`;
                });
        }


// Lancer le chargement une fois que le reste de la page est prêt
window.addEventListener('load', chargerTemoignages);
        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Fade in animation on scroll
        function animateOnScroll() {
            const elements = document.querySelectorAll('.fade-in');
            elements.forEach(element => {
                const elementTop = element.getBoundingClientRect().top;
                const elementVisible = 150;
                
                if (elementTop < window.innerHeight - elementVisible) {
                    element.classList.add('visible');
                }
            });
        }

        window.addEventListener('scroll', animateOnScroll);
        animateOnScroll(); // Initial check
       
                          
        // Header background on scroll
        window.addEventListener('scroll', () => {
            const header = document.querySelector('header');
            
            // Si le défilement est supérieur à 100 pixels
            if (window.scrollY > 100) {
                // AJOUTE la classe CSS 'scrolled-header'
                header.classList.add('scrolled-header');
            } else {
                // RETIRE la classe CSS 'scrolled-header'
                header.classList.remove('scrolled-header');
            }
        });
		
// --- FONCTIONNALITÉ DU MENU MOBILE (HAMBURGER) ---
function setupMobileMenu() {
    const menuToggle = document.querySelector('.menu-toggle');
    const navLinks = document.querySelector('.nav-links');
    
    // Vérifie que les éléments existent sur la page avant d'ajouter l'écouteur
    if (menuToggle && navLinks) {
        menuToggle.addEventListener('click', () => {
            // Bascule la classe 'active' sur le bouton (pour l'animation de la croix)
            menuToggle.classList.toggle('active');
            
            // Bascule la classe 'active' sur la liste des liens (pour l'affichage)
            navLinks.classList.toggle('active');
        });
    }
}

// Appeler cette fonction pour qu'elle s'exécute au chargement de la page
window.addEventListener('load', setupMobileMenu);
    </script>
    </body>
</html>